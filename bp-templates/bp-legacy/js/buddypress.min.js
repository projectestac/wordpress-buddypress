var jq=jQuery,bp_ajax_request=null,newest_activities="",activity_last_recorded=0,directoryPreferences={};function bp_get_directory_preference(directoryType,pref){var defaultPrefs={filter:"",scope:"",extras:""};if(!directoryPreferences.hasOwnProperty(directoryType)){var newPreferences={};for(var prefName in defaultPrefs)defaultPrefs.hasOwnProperty(prefName)&&(newPreferences[prefName]=defaultPrefs[prefName]);directoryPreferences[directoryType]=newPreferences}return BP_DTheme.store_filter_settings&&(directoryPreferences[directoryType][pref]=jq.cookie("bp-"+directoryType+"-"+pref)),directoryPreferences[directoryType][pref]}function bp_set_directory_preference(directoryType,pref,value){var defaultPrefs={filter:"",scope:"",extras:""};if(!directoryPreferences.hasOwnProperty(directoryType)){var newPreferences={};for(var prefName in defaultPrefs)defaultPrefs.hasOwnProperty(prefName)&&(newPreferences[prefName]=defaultPrefs[prefName]);directoryPreferences[directoryType]=newPreferences}BP_DTheme.store_filter_settings&&jq.cookie("bp-"+directoryType+"-"+pref,value,{path:"/",secure:"https:"===window.location.protocol}),directoryPreferences[directoryType][pref]=value}function bp_init_activity(){var scope=bp_get_directory_preference("activity","scope"),filter=bp_get_directory_preference("activity","filter");void 0!==filter&&jq("#activity-filter-select").length&&jq('#activity-filter-select select option[value="'+filter+'"]').prop("selected",!0),void 0!==scope&&jq(".activity-type-tabs").length&&(jq(".activity-type-tabs li").each((function(){jq(this).removeClass("selected")})),jq("#activity-"+scope+", .item-list-tabs li.current").addClass("selected"))}function bp_init_objects(objects){jq(objects).each((function(i){var scope=bp_get_directory_preference(objects[i],"scope"),filter=bp_get_directory_preference(objects[i],"filter");void 0!==filter&&jq("#"+objects[i]+"-order-select select").length&&jq("#"+objects[i]+'-order-select select option[value="'+filter+'"]').prop("selected",!0),void 0!==scope&&jq("div."+objects[i]).length&&(jq(".item-list-tabs li").each((function(){jq(this).removeClass("selected")})),jq("#"+objects[i]+"-"+scope+", #object-nav li.current").addClass("selected"))}))}function bp_filter_request(object,filter,scope,target,search_terms,page,extras,caller,template){if("activity"===object)return!1;null===scope&&(scope="all"),bp_set_directory_preference(object,"scope",scope),bp_set_directory_preference(object,"filter",filter),bp_set_directory_preference(object,"extras",extras),jq(".item-list-tabs li").each((function(){jq(this).removeClass("selected")})),jq("#"+object+"-"+scope+", #object-nav li.current").addClass("selected"),jq(".item-list-tabs li.selected").addClass("loading"),jq('.item-list-tabs select option[value="'+filter+'"]').prop("selected",!0),"friends"!==object&&"group_members"!==object||(object="members"),bp_ajax_request&&bp_ajax_request.abort();var cookies={};cookies["bp-"+object+"-filter"]=bp_get_directory_preference(object,"filter"),cookies["bp"+object+"-scope"]=bp_get_directory_preference(object,"scope");var cookie=encodeURIComponent(jq.param(cookies));bp_ajax_request=jq.post(ajaxurl,{action:object+"_filter",cookie:cookie,object:object,filter:filter,search_terms:search_terms,scope:scope,page:page,extras:extras,template:template},(function(response){if("pag-bottom"===caller&&jq("#subnav").length){var top=jq("#subnav").parent();jq("html,body").animate({scrollTop:top.offset().top},"slow",(function(){jq(target).fadeOut(100,(function(){jq(this).html(response),jq(this).fadeIn(100)}))}))}else jq(target).fadeOut(100,(function(){jq(this).html(response),jq(this).fadeIn(100)}));jq(".item-list-tabs li.selected").removeClass("loading")}))}function bp_activity_request(scope,filter){bp_set_directory_preference("activity","scope",scope),bp_set_directory_preference("activity","filter",filter),jq(".item-list-tabs li").each((function(){jq(this).removeClass("selected loading")})),jq("#activity-"+scope+", .item-list-tabs li.current").addClass("selected"),jq("#object-nav.item-list-tabs li.selected, div.activity-type-tabs li.selected").addClass("loading"),jq('#activity-filter-select select option[value="'+filter+'"]').prop("selected",!0),jq(".widget_bp_activity_widget h2 span.ajax-loader").show(),bp_ajax_request&&bp_ajax_request.abort();var cookies={"bp-activity-filter":bp_get_directory_preference("activity","filter"),"bp-activity-scope":bp_get_directory_preference("activity","scope")},cookie=encodeURIComponent(jq.param(cookies));bp_ajax_request=jq.post(ajaxurl,{action:"activity_widget_filter",cookie:cookie,_wpnonce_activity_filter:jq("#_wpnonce_activity_filter").val(),scope:scope,filter:filter},(function(response){jq(".widget_bp_activity_widget h2 span.ajax-loader").hide(),jq("div.activity").fadeOut(100,(function(){jq(this).html(response.contents),jq(this).fadeIn(100),bp_legacy_theme_hide_comments()})),void 0!==response.feed_url&&jq(".directory #subnav li.feed a, .home-page #subnav li.feed a").attr("href",response.feed_url),jq(".item-list-tabs li.selected").removeClass("loading")}),"json")}function bp_legacy_theme_hide_comments(){var comments_divs=jq("div.activity-comments"),parent_li,comment_lis,comment_count;if(!comments_divs.length)return!1;comments_divs.each((function(){jq(this).children("ul").children("li").length<5||(comments_div=jq(this),parent_li=comments_div.parents("#activity-stream > li"),comment_lis=jq(this).children("ul").children("li"),comment_count=" ",jq("#"+parent_li.attr("id")+" li").length&&(comment_count=jq("#"+parent_li.attr("id")+" li").length),comment_lis.each((function(i){i<comment_lis.length-5&&(jq(this).hide(),i||jq(this).before('<li class="show-all"><a href="#'+parent_li.attr("id")+'/show-all/">'+BP_DTheme.show_x_comments.replace("%d",comment_count)+"</a></li>"))})))}))}function checkAll(){var checkboxes=document.getElementsByTagName("input"),i;for(i=0;i<checkboxes.length;i++)"checkbox"===checkboxes[i].type&&(""===$("check_all").checked?checkboxes[i].checked="":checkboxes[i].checked="checked")}function clear(container){if(container=document.getElementById(container)){var radioButtons=container.getElementsByTagName("INPUT"),options=container.getElementsByTagName("OPTION"),i=0;if(radioButtons)for(i=0;i<radioButtons.length;i++)radioButtons[i].checked="";if(options)for(i=0;i<options.length;i++)options[i].selected=!1}}function bp_get_cookies(){var allCookies=document.cookie.split(";"),bpCookies={},cookiePrefix="bp-",i,cookie,delimiter,name,value;for(i=0;i<allCookies.length;i++)delimiter=(cookie=allCookies[i]).indexOf("="),name=jq.trim(unescape(cookie.slice(0,delimiter))),value=unescape(cookie.slice(delimiter+1)),0===name.indexOf("bp-")&&(bpCookies[name]=value);return encodeURIComponent(jq.param(bpCookies))}function bp_get_query_var(param,url){var qs={};return(url=void 0===url?location.search.substr(1).split("&"):url.split("?")[1].split("&")).forEach((function(item){qs[item.split("=")[0]]=item.split("=")[1]&&decodeURIComponent(item.split("=")[1])})),!(!qs.hasOwnProperty(param)||null==qs[param])&&qs[param]}jq(document).ready((function(){var activity_oldestpage=1;bp_init_activity();var objects=["members","groups","blogs","group_members"],$whats_new=jq("#whats-new");if(bp_init_objects(objects),$whats_new.length&&bp_get_querystring("r")){var $member_nicename=$whats_new.val();$whats_new.animate({height:"3.8em"}),jq.scrollTo($whats_new,500,{offset:-125,easing:"swing"}),$whats_new.val("").focus().val($member_nicename)}if($whats_new.focus((function(){jq("#aw-whats-new-submit").prop("disabled",!1),jq(this).parent().addClass("active"),jq("#whats-new-content").addClass("active");var $whats_new_form=jq("form#whats-new-form"),$activity_all=jq("#activity-all");$whats_new_form.hasClass("submitted")&&$whats_new_form.removeClass("submitted"),$activity_all.length&&($activity_all.hasClass("selected")?"-1"!==jq("#activity-filter-select select").val()&&(jq("#activity-filter-select select").val("-1"),jq("#activity-filter-select select").trigger("change")):(jq("#activity-filter-select select").val("-1"),$activity_all.children("a").trigger("click")))})),jq("#whats-new-form").on("focusout",(function(e){var elem=jq(this);setTimeout((function(){if(!elem.find(":hover").length){if(""!==$whats_new.val())return;jq("#aw-whats-new-submit").prop("disabled",!0),jq("#whats-new-content").removeClass("active"),$whats_new.parent().removeClass("active")}}),0)})),jq("#aw-whats-new-submit").on("click",(function(){var last_date_recorded=0,button=jq(this),form=button.closest("form#whats-new-form"),inputs={},post_data;return jq.each(form.serializeArray(),(function(key,input){"_"!==input.name.substr(0,1)&&"whats-new"!==input.name.substr(0,9)&&(inputs[input.name]?jq.isArray(inputs[input.name])?inputs[input.name].push(input.value):inputs[input.name]=new Array(inputs[input.name],input.value):inputs[input.name]=input.value)})),form.find("*").each((function(){(jq.nodeName(this,"textarea")||jq.nodeName(this,"input"))&&jq(this).prop("disabled",!0)})),jq("div.error").remove(),button.addClass("loading"),button.prop("disabled",!0),form.addClass("submitted"),object="",item_id=jq("#whats-new-post-in").val(),content=jq("#whats-new").val(),firstrow=jq("#buddypress ul.activity-list li").first(),activity_row=firstrow,timestamp=null,firstrow.length&&(activity_row.hasClass("load-newest")&&(activity_row=firstrow.next()),timestamp=activity_row.prop("class").match(/date-recorded-([0-9]+)/)),timestamp&&(last_date_recorded=timestamp[1]),item_id>0&&(object=jq("#whats-new-post-object").val()),post_data=jq.extend({action:"post_update",cookie:bp_get_cookies(),_wpnonce_post_update:jq("#_wpnonce_post_update").val(),content:content,object:object,item_id:item_id,since:last_date_recorded,_bp_as_nonce:jq("#_bp_as_nonce").val()||""},inputs),jq.post(ajaxurl,post_data,(function(response){if(form.find("*").each((function(){(jq.nodeName(this,"textarea")||jq.nodeName(this,"input"))&&jq(this).prop("disabled",!1)})),response[0]+response[1]==="-1")form.prepend(response.substr(2,response.length)),jq("#"+form.attr("id")+" div.error").hide().fadeIn(200);else{if(0===jq("ul.activity-list").length&&(jq("div.error").slideUp(100).remove(),jq("#message").slideUp(100).remove(),jq("div.activity").append('<ul id="activity-stream" class="activity-list item-list">')),firstrow.hasClass("load-newest")&&firstrow.remove(),jq("#activity-stream").prepend(response),last_date_recorded||jq("#activity-stream li:first").addClass("new-update just-posted"),0!==jq("#latest-update").length){var l=jq("#activity-stream li.new-update .activity-content .activity-inner p").html(),v=jq("#activity-stream li.new-update .activity-content .activity-header p a.view").attr("href"),ltext=jq("#activity-stream li.new-update .activity-content .activity-inner p").text(),u="";""!==ltext&&(u=l+" "),u+='<a href="'+v+'" rel="nofollow">'+BP_DTheme.view+"</a>",jq("#latest-update").slideUp(300,(function(){jq("#latest-update").html(u),jq("#latest-update").slideDown(300)}))}jq("li.new-update").hide().slideDown(300),jq("li.new-update").removeClass("new-update"),jq("#whats-new").val(""),form.get(0).reset(),newest_activities="",activity_last_recorded=0}jq("#whats-new-options").slideUp(),jq("#whats-new-form textarea").animate({height:"2.2em"}),jq("#aw-whats-new-submit").prop("disabled",!0).removeClass("loading"),jq("#whats-new-content").removeClass("active")})),!1})),jq("div.activity-type-tabs").on("click",(function(event){var target=jq(event.target).parent(),scope,filter;if("STRONG"===event.target.nodeName||"SPAN"===event.target.nodeName)target=target.parent();else if("A"!==event.target.nodeName)return!1;return scope=target.attr("id").substr(9,target.attr("id").length),filter=jq("#activity-filter-select select").val(),"mentions"===scope&&jq("#"+target.attr("id")+" a strong").remove(),bp_activity_request(scope,filter),!1})),jq("#activity-filter-select select").change((function(){var selected_tab=jq("div.activity-type-tabs li.selected"),filter=jq(this).val(),scope;return bp_activity_request(scope=selected_tab.length?selected_tab.attr("id").substr(9,selected_tab.attr("id").length):null,filter),!1})),jq("div.activity").on("click",(function(event){var target=jq(event.target),type,parent,parent_id,li,id,link_href,nonce,timestamp,oldest_page,just_posted;return target.hasClass("fav")||target.hasClass("unfav")?!target.hasClass("loading")&&(type=target.hasClass("fav")?"fav":"unfav",parent_id=(parent=target.closest(".activity-item")).attr("id").substr(9,parent.attr("id").length),nonce=bp_get_query_var("_wpnonce",target.attr("href")),target.addClass("loading"),jq.post(ajaxurl,{action:"activity_mark_"+type,cookie:bp_get_cookies(),id:parent_id,nonce:nonce},(function(response){target.removeClass("loading"),target.fadeOut(200,(function(){jq(this).html(response),jq(this).attr("title","fav"===type?BP_DTheme.remove_fav:BP_DTheme.mark_as_fav),jq(this).fadeIn(200)})),"fav"===type?(jq(".item-list-tabs #activity-favs-personal-li").length||(jq(".item-list-tabs #activity-favorites").length||jq(".item-list-tabs ul #activity-mentions").before('<li id="activity-favorites"><a href="#">'+BP_DTheme.my_favs+" <span>0</span></a></li>"),jq(".item-list-tabs ul #activity-favorites span").html(Number(jq(".item-list-tabs ul #activity-favorites span").html())+1)),target.removeClass("fav"),target.addClass("unfav")):(target.removeClass("unfav"),target.addClass("fav"),jq(".item-list-tabs ul #activity-favorites span").html(Number(jq(".item-list-tabs ul #activity-favorites span").html())-1),Number(jq(".item-list-tabs ul #activity-favorites span").html())||(jq(".item-list-tabs ul #activity-favorites").hasClass("selected")&&bp_activity_request(null,null),jq(".item-list-tabs ul #activity-favorites").remove())),"activity-favorites"===jq(".item-list-tabs li.selected").attr("id")&&target.closest(".activity-item").slideUp(100)})),!1):target.hasClass("delete-activity")?(id=(li=target.parents("div.activity ul li")).attr("id").substr(9,li.attr("id").length),nonce=(link_href=target.attr("href")).split("_wpnonce="),timestamp=li.prop("class").match(/date-recorded-([0-9]+)/),nonce=nonce[1],target.addClass("loading"),jq.post(ajaxurl,{action:"delete_activity",cookie:bp_get_cookies(),id:id,_wpnonce:nonce},(function(response){response[0]+response[1]==="-1"?(li.prepend(response.substr(2,response.length)),li.children("#message").hide().fadeIn(300)):(li.slideUp(300),timestamp&&activity_last_recorded===timestamp[1]&&(newest_activities="",activity_last_recorded=0))})),!1):target.hasClass("spam-activity")?(li=target.parents("div.activity ul li"),timestamp=li.prop("class").match(/date-recorded-([0-9]+)/),target.addClass("loading"),jq.post(ajaxurl,{action:"bp_spam_activity",cookie:encodeURIComponent(document.cookie),id:li.attr("id").substr(9,li.attr("id").length),_wpnonce:target.attr("href").split("_wpnonce=")[1]},(function(response){response[0]+response[1]==="-1"?(li.prepend(response.substr(2,response.length)),li.children("#message").hide().fadeIn(300)):(li.slideUp(300),timestamp&&activity_last_recorded===timestamp[1]&&(newest_activities="",activity_last_recorded=0))})),!1):target.parent().hasClass("load-more")?(bp_ajax_request&&bp_ajax_request.abort(),jq("#buddypress li.load-more").addClass("loading"),oldest_page=activity_oldestpage+1,just_posted=[],jq(".activity-list li.just-posted").each((function(){just_posted.push(jq(this).attr("id").replace("activity-",""))})),load_more_args={action:"activity_get_older_updates",cookie:bp_get_cookies(),page:oldest_page,exclude_just_posted:just_posted.join(",")},load_more_search=bp_get_querystring("s"),load_more_search&&(load_more_args.search_terms=load_more_search),bp_ajax_request=jq.post(ajaxurl,load_more_args,(function(response){jq("#buddypress li.load-more").removeClass("loading"),activity_oldestpage=oldest_page,jq("#buddypress ul.activity-list").append(response.contents),target.parent().hide()}),"json"),!1):void(target.parent().hasClass("load-newest")&&(event.preventDefault(),target.parent().hide(),activity_html=jq.parseHTML(newest_activities),jq.each(activity_html,(function(i,el){"LI"===el.nodeName&&jq(el).hasClass("just-posted")&&jq("#"+jq(el).attr("id")).length&&jq("#"+jq(el).attr("id")).remove()})),jq("#buddypress ul.activity-list").prepend(newest_activities),newest_activities=""))})),jq("div.activity").on("click",".activity-read-more a",(function(event){var target=jq(event.target),link_id=target.parent().attr("id").split("-"),a_id=link_id[3],type=link_id[0],inner_class,a_inner;return a_inner=jq("#"+type+"-"+a_id+" ."+(inner_class="acomment"===type?"acomment-content":"activity-inner")+":first"),jq(target).addClass("loading"),jq.post(ajaxurl,{action:"get_single_activity_content",activity_id:a_id},(function(response){jq(a_inner).slideUp(300).html(response).slideDown(300)})),!1})),jq("form.ac-form").hide(),jq(".activity-comments").length&&bp_legacy_theme_hide_comments(),jq("div.activity").on("click",(function(event){var target=jq(event.target),id,ids,a_id,c_id,form,form_parent,form_id,tmp_id,comment_id,comment,ajaxdata,ak_nonce,show_all_a,new_count,link_href,comment_li,nonce;return target.hasClass("acomment-reply")||target.parent().hasClass("acomment-reply")?(target.parent().hasClass("acomment-reply")&&(target=target.parent()),a_id=(ids=(id=target.attr("id")).split("-"))[2],c_id=target.attr("href").substr(10,target.attr("href").length),(form=jq("#ac-form-"+a_id)).css("display","none"),form.removeClass("root"),jq(".ac-form").hide(),form.children("div").each((function(){jq(this).hasClass("error")&&jq(this).hide()})),"comment"!==ids[1]?jq("#acomment-"+c_id).append(form):jq("#activity-"+a_id+" .activity-comments").append(form),form.parent().hasClass("activity-comments")&&form.addClass("root"),form.slideDown(200),jq.scrollTo(form,500,{offset:-100,easing:"swing"}),jq("#ac-form-"+ids[2]+" textarea").focus(),!1):"ac_form_submit"===target.attr("name")?(form_parent=(form=target.parents("form")).parent(),form_id=form.attr("id").split("-"),comment_id=form_parent.hasClass("activity-comments")?form_id[2]:(tmp_id=form_parent.attr("id").split("-"))[1],content=jq("#"+form.attr("id")+" textarea"),jq("#"+form.attr("id")+" div.error").hide(),target.addClass("loading").prop("disabled",!0),content.addClass("loading").prop("disabled",!0),ajaxdata={action:"new_activity_comment",cookie:bp_get_cookies(),_wpnonce_new_activity_comment:jq("#_wpnonce_new_activity_comment").val(),comment_id:comment_id,form_id:form_id[2],content:content.val()},(ak_nonce=jq("#_bp_as_nonce_"+comment_id).val())&&(ajaxdata["_bp_as_nonce_"+comment_id]=ak_nonce),jq.post(ajaxurl,ajaxdata,(function(response){if(target.removeClass("loading"),content.removeClass("loading"),response[0]+response[1]==="-1")form.append(jq(response.substr(2,response.length)).hide().fadeIn(200));else{var activity_comments=form.parent();form.fadeOut(200,(function(){0===activity_comments.children("ul").length&&(activity_comments.hasClass("activity-comments")?activity_comments.prepend("<ul></ul>"):activity_comments.append("<ul></ul>"));var the_comment=jq.trim(response);activity_comments.children("ul").append(jq(the_comment).hide().fadeIn(200)),form.children("textarea").val(""),activity_comments.parent().addClass("has-comments")})),jq("#"+form.attr("id")+" textarea").val(""),new_count=Number(jq("#activity-"+form_id[2]+" a.acomment-reply span").html())+1,jq("#activity-"+form_id[2]+" a.acomment-reply span").html(new_count),(show_all_a=activity_comments.parents(".activity-comments").find(".show-all a"))&&show_all_a.html(BP_DTheme.show_x_comments.replace("%d",new_count))}jq(target).prop("disabled",!1),jq(content).prop("disabled",!1)})),!1):target.hasClass("acomment-delete")?(link_href=target.attr("href"),comment_li=target.parent().parent(),form=comment_li.parents("div.activity-comments").children("form"),nonce=(nonce=link_href.split("_wpnonce="))[1],comment_id=(comment_id=(comment_id=link_href.split("cid="))[1].split("&"))[0],target.addClass("loading"),jq(".activity-comments ul .error").remove(),comment_li.parents(".activity-comments").append(form),jq.post(ajaxurl,{action:"delete_activity_comment",cookie:bp_get_cookies(),_wpnonce:nonce,id:comment_id},(function(response){if(response[0]+response[1]==="-1")comment_li.prepend(jq(response.substr(2,response.length)).hide().fadeIn(200));else{var children=jq("#"+comment_li.attr("id")+" ul").children("li"),child_count=0,count_span,new_count,show_all_a;jq(children).each((function(){jq(this).is(":hidden")||child_count++})),comment_li.fadeOut(200,(function(){comment_li.remove()})),new_count=(count_span=jq("#"+comment_li.parents("#activity-stream > li").attr("id")+" a.acomment-reply span")).html()-(1+child_count),count_span.html(new_count),(show_all_a=comment_li.parents(".activity-comments").find(".show-all a"))&&show_all_a.html(BP_DTheme.show_x_comments.replace("%d",new_count)),0===new_count&&jq(comment_li.parents("#activity-stream > li")).removeClass("has-comments")}})),!1):target.hasClass("spam-activity-comment")?(link_href=target.attr("href"),comment_li=target.parent().parent(),target.addClass("loading"),jq(".activity-comments ul div.error").remove(),comment_li.parents(".activity-comments").append(comment_li.parents(".activity-comments").children("form")),jq.post(ajaxurl,{action:"bp_spam_activity_comment",cookie:encodeURIComponent(document.cookie),_wpnonce:link_href.split("_wpnonce=")[1],id:link_href.split("cid=")[1].split("&")[0]},(function(response){if(response[0]+response[1]==="-1")comment_li.prepend(jq(response.substr(2,response.length)).hide().fadeIn(200));else{var children=jq("#"+comment_li.attr("id")+" ul").children("li"),child_count=0,parent_li;jq(children).each((function(){jq(this).is(":hidden")||child_count++})),comment_li.fadeOut(200),parent_li=comment_li.parents("#activity-stream > li"),jq("#"+parent_li.attr("id")+" a.acomment-reply span").html(jq("#"+parent_li.attr("id")+" a.acomment-reply span").html()-(1+child_count))}})),!1):target.parent().hasClass("show-all")?(target.parent().addClass("loading"),setTimeout((function(){target.parent().parent().children("li").fadeIn(200,(function(){target.parent().remove()}))}),600),!1):target.hasClass("ac-reply-cancel")?(jq(target).closest(".ac-form").slideUp(200),!1):void 0})),jq(document).keydown((function(e){var keyCode;((e=e||window.event).target?element=e.target:e.srcElement&&(element=e.srcElement),3===element.nodeType&&(element=element.parentNode),!0!==e.ctrlKey&&!0!==e.altKey&&!0!==e.metaKey)&&(27===(e.keyCode?e.keyCode:e.which)&&"TEXTAREA"===element.tagName&&jq(element).hasClass("ac-input")&&jq(element).parent().parent().parent().slideUp(200))})),jq(".dir-search, .groups-members-search").on("click",(function(event){if(!jq(this).hasClass("no-ajax")){var target=jq(event.target),css_id,object,template,search_terms;if("submit"===target.attr("type")){object=(css_id=jq(".item-list-tabs li.selected").attr("id").split("-"))[0],template=null,search_terms=target.parent().find("#"+object+"_search").val(),"groups-members-search"===event.currentTarget.className&&(object="group_members",template="groups/single/members");var scope=bp_get_directory_preference(object,"scope"),filter,extras;return bp_filter_request(object,bp_get_directory_preference(object,"filter"),scope,"div."+object,search_terms,1,bp_get_directory_preference(object,"extras"),null,template),!1}}})),jq("div.item-list-tabs").on("click",(function(event){if(jq("body").hasClass("type")&&jq("body").hasClass("directory")&&jq(this).addClass("no-ajax"),!jq(this).hasClass("no-ajax")&&!jq(event.target).hasClass("no-ajax")){var targetElem="SPAN"===event.target.nodeName?event.target.parentNode:event.target,target=jq(targetElem).parent(),css_id,object,scope,filter,search_terms,extras;if("LI"===target[0].nodeName&&!target.hasClass("last"))return"activity"!==(object=(css_id=target.attr("id").split("-"))[0])&&(scope=css_id[1],bp_filter_request(object,filter=jq("#"+object+"-order-select select").val(),scope,"div."+object,search_terms=jq("#"+object+"_search").val(),1,bp_get_directory_preference(object,"extras")),!1)}})),jq("li.filter select").change((function(){var el,css_id,object,scope,filter,search_terms,template,$gm_search,extras;return object=(css_id=(el=jq(".item-list-tabs li.selected").length?jq(".item-list-tabs li.selected"):jq(this)).attr("id").split("-"))[0],scope=css_id[1],filter=jq(this).val(),search_terms=!1,template=null,jq(".dir-search input").length&&(search_terms=jq(".dir-search input").val()),($gm_search=jq(".groups-members-search input")).length&&(search_terms=$gm_search.val(),object="members",scope="groups"),"members"===object&&"groups"===scope&&(object="group_members",template="groups/single/members"),"friends"===object&&(object="members"),bp_filter_request(object,filter,scope,"div."+object,search_terms,1,bp_get_directory_preference(object,"extras"),null,template),!1})),jq("#buddypress").on("click",(function(event){var target=jq(event.target),el,css_id,object,search_terms,pagination_id,template,page_number,$gm_search,caller;if(target.hasClass("button"))return!0;if(target.parent().parent().hasClass("pagination")&&!target.parent().parent().hasClass("no-ajax")){if(target.hasClass("dots")||target.hasClass("current"))return!1;object=(css_id=(el=jq(".item-list-tabs li.selected").length?jq(".item-list-tabs li.selected"):jq("li.filter select")).attr("id").split("-"))[0],search_terms=!1,pagination_id=jq(target).closest(".pagination-links").attr("id"),template=null,jq("div.dir-search input").length&&(search_terms=!(search_terms=jq(".dir-search input")).val()&&bp_get_querystring(search_terms.attr("name"))?jq(".dir-search input").prop("placeholder"):search_terms.val()),page_number=jq(target).hasClass("next")||jq(target).hasClass("prev")?jq(".pagination span.current").html():jq(target).html(),page_number=Number(page_number.replace(/\D/g,"")),jq(target).hasClass("next")?page_number++:jq(target).hasClass("prev")&&page_number--,($gm_search=jq(".groups-members-search input")).length&&(search_terms=$gm_search.val(),object="members"),"members"===object&&"groups"===css_id[1]&&(object="group_members",template="groups/single/members"),"admin"===object&&jq("body").hasClass("membership-requests")&&(object="requests"),caller=-1!==pagination_id.indexOf("pag-bottom")?"pag-bottom":null;var scope=bp_get_directory_preference(object,"scope"),filter,extras;return bp_filter_request(object,bp_get_directory_preference(object,"filter"),scope,"div."+object,search_terms,page_number,bp_get_directory_preference(object,"extras"),caller,template),!1}})),jq("#send-invite-form").on("click","#invite-list input",(function(){var invites_new_template=jq("#send-invite-form > .invite").length,friend_id,friend_action;jq(".ajax-loader").toggle(),invites_new_template&&jq(this).parents("ul").find("input").prop("disabled",!0),friend_id=jq(this).val(),friend_action=!0===jq(this).prop("checked")?"invite":"uninvite",invites_new_template||jq(".item-list-tabs li.selected").addClass("loading"),jq.post(ajaxurl,{action:"groups_invite_user",friend_action:friend_action,cookie:bp_get_cookies(),_wpnonce:jq("#_wpnonce_invite_uninvite_user").val(),friend_id:friend_id,group_id:jq("#group_id").val()},(function(response){jq("#message")&&jq("#message").hide(),invites_new_template?bp_filter_request("invite","bp-invite-filter","bp-invite-scope","div.invite",!1,1,"","",""):(jq(".ajax-loader").toggle(),"invite"===friend_action?jq("#friend-list").append(response):"uninvite"===friend_action&&jq("#friend-list li#uid-"+friend_id).remove(),jq(".item-list-tabs li.selected").removeClass("loading"))}))})),jq("#send-invite-form").on("click","a.remove",(function(){var invites_new_template=jq("#send-invite-form > .invite").length,friend_id=jq(this).attr("id");return jq(".ajax-loader").toggle(),friend_id=(friend_id=friend_id.split("-"))[1],jq.post(ajaxurl,{action:"groups_invite_user",friend_action:"uninvite",cookie:bp_get_cookies(),_wpnonce:jq("#_wpnonce_invite_uninvite_user").val(),friend_id:friend_id,group_id:jq("#group_id").val()},(function(response){invites_new_template?bp_filter_request("invite","bp-invite-filter","bp-invite-scope","div.invite",!1,1,"","",""):(jq(".ajax-loader").toggle(),jq("#friend-list #uid-"+friend_id).remove(),jq("#invite-list #f-"+friend_id).prop("checked",!1))})),!1})),jq(".visibility-toggle-link").on("click",(function(event){event.preventDefault(),jq(this).attr("aria-expanded","true").parent().hide().addClass("field-visibility-settings-hide").siblings(".field-visibility-settings").show().addClass("field-visibility-settings-open")})),jq(".field-visibility-settings-close").on("click",(function(event){event.preventDefault(),jq(".visibility-toggle-link").attr("aria-expanded","false");var settings_div=jq(this).parent(),vis_setting_text=settings_div.find("input:checked").parent().text();settings_div.hide().removeClass("field-visibility-settings-open").siblings(".field-visibility-settings-toggle").children(".current-visibility-level").text(vis_setting_text).end().show().removeClass("field-visibility-settings-hide")})),jq("#profile-edit-form input:not(:submit), #profile-edit-form textarea, #profile-edit-form select, #signup_form input:not(:submit), #signup_form textarea, #signup_form select").change((function(){var shouldconfirm=!0;jq("#profile-edit-form input:submit, #signup_form input:submit").on("click",(function(){shouldconfirm=!1})),window.onbeforeunload=function(e){if(shouldconfirm)return BP_DTheme.unsaved_changes}})),jq("#friend-list a.accept, #friend-list a.reject").on("click",(function(){var button=jq(this),li=jq(this).parents("#friend-list li"),action_div=jq(this).parents("li div.action"),id=li.attr("id").substr(11,li.attr("id").length),link_href,nonce=button.attr("href").split("_wpnonce=")[1],action;return!jq(this).hasClass("accepted")&&!jq(this).hasClass("rejected")&&(jq(this).hasClass("accept")?(action="accept_friendship",action_div.children("a.reject").css("visibility","hidden")):(action="reject_friendship",action_div.children("a.accept").css("visibility","hidden")),button.addClass("loading"),jq.post(ajaxurl,{action:action,cookie:bp_get_cookies(),id:id,_wpnonce:nonce},(function(response){button.removeClass("loading"),response[0]+response[1]==="-1"?(li.prepend(response.substr(2,response.length)),li.children("#message").hide().fadeIn(200)):button.fadeOut(100,(function(){jq(this).hasClass("accept")?(action_div.children("a.reject").hide(),jq(this).html(BP_DTheme.accepted).contents().unwrap()):(action_div.children("a.accept").hide(),jq(this).html(BP_DTheme.rejected).contents().unwrap())}))})),!1)})),jq("#members-dir-list, #members-group-list, #item-header").on("click",".friendship-button a",(function(){jq(this).parent().addClass("loading");var fid=jq(this).attr("id"),nonce=jq(this).attr("href"),thelink=jq(this);return fid=(fid=fid.split("-"))[1],nonce=(nonce=(nonce=nonce.split("?_wpnonce="))[1].split("&"))[0],jq.post(ajaxurl,{action:"addremove_friend",cookie:bp_get_cookies(),fid:fid,_wpnonce:nonce},(function(response){var action=thelink.attr("rel");parentdiv=thelink.parent(),"add"===action?jq(parentdiv).fadeOut(200,(function(){parentdiv.removeClass("add_friend"),parentdiv.removeClass("loading"),parentdiv.addClass("pending_friend"),parentdiv.fadeIn(200).html(response)})):"remove"===action&&jq(parentdiv).fadeOut(200,(function(){parentdiv.removeClass("remove_friend"),parentdiv.removeClass("loading"),parentdiv.addClass("add"),parentdiv.fadeIn(200).html(response)}))})),!1})),jq("#buddypress").on("click",".group-button .leave-group",(function(){if(!1===confirm(BP_DTheme.leave_group_confirm))return!1})),jq("#groups-dir-list").on("click",".group-button a",(function(){var gid=jq(this).parent().attr("id"),nonce=jq(this).attr("href"),thelink=jq(this);return gid=(gid=gid.split("-"))[1],nonce=(nonce=(nonce=nonce.split("?_wpnonce="))[1].split("&"))[0],(!thelink.hasClass("leave-group")||!1!==confirm(BP_DTheme.leave_group_confirm))&&(jq.post(ajaxurl,{action:"joinleave_group",cookie:bp_get_cookies(),gid:gid,_wpnonce:nonce},(function(response){var parentdiv=thelink.parent();jq("body.directory").length?jq(parentdiv).fadeOut(200,(function(){parentdiv.fadeIn(200).html(response);var mygroups=jq("#groups-personal span"),add=1;thelink.hasClass("leave-group")?(parentdiv.hasClass("hidden")&&parentdiv.closest("li").slideUp(200),add=0):thelink.hasClass("request-membership")&&(add=!1),mygroups.length&&!1!==add&&(add?mygroups.text(1+(mygroups.text()>>0)):mygroups.text((mygroups.text()>>0)-1))})):window.location.reload()})),!1)})),jq("#groups-list li.hidden").each((function(){"none"===jq(this).css("display")&&jq(this).css("cssText","display: list-item !important")})),jq("#buddypress").on("click",".pending",(function(){return!1})),jq("body").hasClass("register")){var blog_checked=jq("#signup_with_blog");blog_checked.prop("checked")||jq("#blog-details").toggle(),blog_checked.change((function(){jq("#blog-details").toggle()}))}jq(".message-search").on("click",(function(event){if(!jq(this).hasClass("no-ajax")){var target=jq(event.target),object;if("submit"===target.attr("type")||"button"===target.attr("type")){var scope=bp_get_directory_preference(object="messages","scope"),filter=bp_get_directory_preference(object,"filter"),extras=bp_get_directory_preference(object,"extras");return bp_filter_request(object,filter,scope,"div."+object,jq("#messages_search").val(),1,extras),!1}}})),jq("#send_reply_button").click((function(){var order=jq("#messages_order").val()||"ASC",offset=jq("#message-recipients").offset(),button=jq("#send_reply_button");return jq(button).addClass("loading").prop("disabled",!0),jq.post(ajaxurl,{action:"messages_send_reply",cookie:bp_get_cookies(),_wpnonce:jq("#send_message_nonce").val(),content:jq("#message_content").val(),send_to:jq("#send_to").val(),subject:jq("#subject").val(),thread_id:jq("#thread_id").val()},(function(response){response[0]+response[1]==="-1"?jq("#send-reply").prepend(response.substr(2,response.length)):(jq("#send-reply #message").remove(),jq("#message_content").val(""),"ASC"===order?jq("#send-reply").before(response):(jq("#message-recipients").after(response),jq(window).scrollTop(offset.top)),jq(".new-message").hide().slideDown(200,(function(){jq(".new-message").removeClass("new-message")}))),jq(button).removeClass("loading").prop("disabled",!1)})),!1})),jq("body.messages #item-body div.messages").on("change","#message-type-select",(function(){var selection=this.value,checkboxes=jq('td input[type="checkbox"]'),checked_value="checked";switch(checkboxes.each((function(i){checkboxes[i].checked=""})),selection){case"unread":checkboxes=jq('tr.unread td input[type="checkbox"]');break;case"read":checkboxes=jq('tr.read td input[type="checkbox"]');break;case"":checked_value=""}checkboxes.each((function(i){checkboxes[i].checked=checked_value}))})),jq("#select-all-messages").click((function(event){this.checked?jq(".message-check").each((function(){this.checked=!0})):jq(".message-check").each((function(){this.checked=!1}))})),jq("#messages-bulk-manage").attr("disabled","disabled"),jq("#messages-select").on("change",(function(){jq("#messages-bulk-manage").attr("disabled",jq(this).val().length<=0)})),starAction=function(){var link=jq(this);return jq.post(ajaxurl,{action:"messages_star",message_id:link.data("message-id"),star_status:link.data("star-status"),nonce:link.data("star-nonce"),bulk:link.data("star-bulk")},(function(response){1===parseInt(response,10)&&("unstar"===link.data("star-status")?(link.data("star-status","star"),link.removeClass("message-action-unstar").addClass("message-action-star"),link.find(".bp-screen-reader-text").text(BP_PM_Star.strings.text_star),1===BP_PM_Star.is_single_thread?link.attr("data-bp-tooltip",BP_PM_Star.strings.title_star):link.attr("data-bp-tooltip",BP_PM_Star.strings.title_star_thread)):(link.data("star-status","unstar"),link.removeClass("message-action-star").addClass("message-action-unstar"),link.find(".bp-screen-reader-text").text(BP_PM_Star.strings.text_unstar),1===BP_PM_Star.is_single_thread?link.attr("data-bp-tooltip",BP_PM_Star.strings.title_unstar):link.attr("data-bp-tooltip",BP_PM_Star.strings.title_unstar_thread)))})),!1},jq("#message-threads").on("click","td.thread-star a",starAction),jq("#message-thread").on("click",".message-star-actions a",starAction),jq("#message-threads td.bulk-select-check :checkbox").on("change",(function(){var box=jq(this),star=box.closest("tr").find(".thread-star a");box.prop("checked")?"unstar"===star.data("star-status")?BP_PM_Star.star_counter++:BP_PM_Star.unstar_counter++:"unstar"===star.data("star-status")?BP_PM_Star.star_counter--:BP_PM_Star.unstar_counter--,BP_PM_Star.star_counter>0&&0===parseInt(BP_PM_Star.unstar_counter,10)?jq('option[value="star"]').hide():jq('option[value="star"]').show(),BP_PM_Star.unstar_counter>0&&0===parseInt(BP_PM_Star.star_counter,10)?jq('option[value="unstar"]').hide():jq('option[value="unstar"]').show()})),jq("#select-all-notifications").click((function(event){this.checked?jq(".notification-check").each((function(){this.checked=!0})):jq(".notification-check").each((function(){this.checked=!1}))})),jq("#notification-bulk-manage").attr("disabled","disabled"),jq("#notification-select").on("change",(function(){jq("#notification-bulk-manage").attr("disabled",jq(this).val().length<=0)})),jq("#close-notice").on("click",(function(){return jq(this).addClass("loading"),jq("#sidebar div.error").remove(),jq.post(ajaxurl,{action:"messages_close_notice",notice_id:jq(".notice").attr("rel").substr(2,jq(".notice").attr("rel").length),nonce:jq("#close-notice-nonce").val()},(function(response){jq("#close-notice").removeClass("loading"),response[0]+response[1]==="-1"?(jq(".notice").prepend(response.substr(2,response.length)),jq("#sidebar div.error").hide().fadeIn(200)):jq(".notice").slideUp(100)})),!1})),jq("#wp-admin-bar ul.main-nav li, #nav li").mouseover((function(){jq(this).addClass("sfhover")})),jq("#wp-admin-bar ul.main-nav li, #nav li").mouseout((function(){jq(this).removeClass("sfhover")})),jq("#wp-admin-bar-logout, a.logout").on("click",(function(){jq.removeCookie("bp-activity-scope",{path:"/",secure:"https:"===window.location.protocol}),jq.removeCookie("bp-activity-filter",{path:"/",secure:"https:"===window.location.protocol}),jq.removeCookie("bp-activity-oldestpage",{path:"/",secure:"https:"===window.location.protocol});var objects=["members","groups","blogs","forums"];jq(objects).each((function(i){jq.removeCookie("bp-"+objects[i]+"-scope",{path:"/",secure:"https:"===window.location.protocol}),jq.removeCookie("bp-"+objects[i]+"-filter",{path:"/",secure:"https:"===window.location.protocol}),jq.removeCookie("bp-"+objects[i]+"-extras",{path:"/",secure:"https:"===window.location.protocol})}))})),jq("body").hasClass("no-js")&&jq("body").attr("class",jq("body").attr("class").replace(/no-js/,"js")),"undefined"!=typeof wp&&void 0!==wp.heartbeat&&void 0!==BP_DTheme.pulse&&(wp.heartbeat.interval(Number(BP_DTheme.pulse)),jq.fn.extend({"heartbeat-send":function(){return this.bind("heartbeat-send.buddypress")}}));var first_item_recorded=0;jq(document).on("heartbeat-send.buddypress",(function(e,data){first_item_recorded=0,jq("#buddypress ul.activity-list li").first().prop("id")&&(timestamp=jq("#buddypress ul.activity-list li").first().prop("class").match(/date-recorded-([0-9]+)/),timestamp&&(first_item_recorded=timestamp[1])),(0===activity_last_recorded||Number(first_item_recorded)>activity_last_recorded)&&(activity_last_recorded=Number(first_item_recorded)),data.bp_activity_last_recorded=activity_last_recorded,last_recorded_search=bp_get_querystring("s"),last_recorded_search&&(data.bp_activity_last_recorded_search_terms=last_recorded_search)})),jq(document).on("heartbeat-tick",(function(e,data){data.bp_activity_newest_activities&&(newest_activities=data.bp_activity_newest_activities.activities+newest_activities,activity_last_recorded=Number(data.bp_activity_newest_activities.last_recorded),jq("#buddypress ul.activity-list li").first().hasClass("load-newest")||jq("#buddypress ul.activity-list").prepend('<li class="load-newest"><a href="#newest">'+BP_DTheme.newest+"</a></li>"))}))}));